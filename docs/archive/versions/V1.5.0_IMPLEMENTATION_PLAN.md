# NIAC-Go v1.5.0 Implementation Plan

**Target Release:** Q1 2025
**Scope:** All 3 Phases (Full-featured release)
**Estimated Duration:** 3-4 weeks
**Status:** In Progress

---

## Implementation Schedule

### Week 1 - Phase 1: Core Improvements
- **Day 1:** Color-coded debug output
- **Day 2-3:** Per-protocol debug level control
- **Day 4-5:** Multiple IPs per device

### Week 2 - Phase 2: Configuration Enhancements
- **Day 1-2:** HTTP/FTP server config in YAML
- **Day 3-5:** IPv6 as primary device address

### Week 3 - Phase 3: Advanced Features
- **Day 1-3:** Additional traffic patterns
- **Day 4-5:** SNMP trap generation

### Week 4 - Testing & Release
- **Day 1-2:** Integration testing
- **Day 3:** Documentation updates
- **Day 4:** Build releases
- **Day 5:** Release v1.5.0

---

## Phase 1: Core Improvements (Week 1)

### Feature 1: Color-Coded Debug Output ✓ IN PROGRESS

**Duration:** 1 day
**Priority:** HIGH
**Risk:** LOW

#### Implementation Steps:

1. **Add Color Library**
   - Use `fatih/color` - lightweight, no CGO
   - Add to go.mod: `go get github.com/fatih/color`

2. **Create Color Utility Package**
   - Location: `pkg/logging/colors.go`
   - Functions:
     - `Error(format string, args ...interface{})`
     - `Warning(format string, args ...interface{})`
     - `Success(format string, args ...interface{})`
     - `Info(format string, args ...interface{})`
     - `Protocol(name string, format string, args ...interface{})`
     - `Device(name string, format string, args ...interface{})`
   - Add `--no-color` flag support
   - Respect NO_COLOR environment variable

3. **Update Protocol Handlers**
   - Start with high-traffic protocols:
     - DHCP
     - DNS
     - ARP
   - Replace `fmt.Printf` with color functions
   - Keep backward compatibility

4. **Update Main Entry Point**
   - Add color initialization
   - Add `--no-color` CLI flag
   - Banner with colors

#### Files to Modify:
- `pkg/logging/colors.go` (new)
- `cmd/niac/main.go`
- `pkg/protocols/dhcp.go`
- `pkg/protocols/dns.go`
- `pkg/protocols/arp.go`

#### Testing:
- Visual verification with debug output
- Verify NO_COLOR environment variable
- Test --no-color flag

---

### Feature 2: Per-Protocol Debug Level Control

**Duration:** 2-3 days
**Priority:** HIGH
**Risk:** LOW

#### Implementation Steps:

1. **Design Debug Configuration**
   - Create DebugConfig struct
   - Map protocol name → debug level
   - Default to global debug level

2. **Update CLI Flags**
   - Add protocol-specific flags:
     - `--debug-arp`, `--debug-dhcp`, `--debug-dns`, etc.
   - Keep backward compat with `--debug`

3. **Update Stack**
   - Pass DebugConfig to all handlers
   - Each handler queries its own level

4. **Update All Protocol Handlers** (17 handlers)
   - Replace `s.debugLevel` with `s.GetDebugLevel()`
   - Test each protocol independently

#### Files to Modify:
- `cmd/niac/main.go` (CLI flags)
- `pkg/protocols/stack.go` (DebugConfig)
- All 17 protocol handlers

#### Testing:
- Verify individual protocol debug levels
- Test combinations: `--debug-dhcp 3 --debug-arp 1`
- Verify global --debug still works

---

### Feature 3: Multiple IPs per Device

**Duration:** 2-3 days
**Priority:** HIGH
**Risk:** MEDIUM

#### Implementation Steps:

1. **Update Config Structures**
   - Device.IPAddresses already exists (slice)
   - Add backward compat for single `ip` field
   - Update YAML parser

2. **Update Device Table**
   - Support multiple IP lookups per device
   - Update AddByIP to handle multiple IPs

3. **Update Protocol Handlers**
   - ARP: Respond for all device IPs
   - DHCP: Bind to all configured IPs
   - DNS: Return all A records
   - ICMP: Respond on all IPs

4. **Update YAML Examples**
   - Add multi-IP examples
   - Document in complete-reference.yaml

#### Files to Modify:
- `pkg/config/config.go` (YAML parsing)
- `pkg/protocols/device_table.go`
- `pkg/protocols/arp.go`
- `pkg/protocols/dhcp.go`
- `pkg/protocols/dns.go`
- `pkg/protocols/icmp.go`
- `examples/scenario_configs/complete-reference.yaml`

#### Testing:
- Device with multiple IPv4 addresses
- Device with IPv4 + IPv6 addresses
- ARP/ping to all IPs works
- Backward compat with single IP

---

## Phase 2: Configuration Enhancements (Week 2)

### Feature 4: HTTP/FTP Server Config in YAML

**Duration:** 2-3 days
**Priority:** MEDIUM
**Risk:** MEDIUM

#### Implementation Steps:

1. **Design Config Structures**
   ```go
   type HTTPServerConfig struct {
       Enabled   bool
       Port      int
       Endpoints []HTTPEndpoint
   }

   type HTTPEndpoint struct {
       Path         string
       Response     string
       ResponseFile string
       ContentType  string
   }
   ```

2. **Update YAML Parser**
   - Add HTTP/FTP config to Device
   - Parse endpoint configurations

3. **Update HTTP Handler**
   - Load endpoints from config
   - Support file-based responses
   - Keep default endpoints

4. **Update FTP Handler**
   - Configurable banner
   - Configurable commands
   - Anonymous access control

#### Files to Modify:
- `pkg/config/config.go`
- `internal/converter/converter.go`
- `pkg/protocols/http.go`
- `pkg/protocols/ftp.go`
- `examples/scenario_configs/complete-reference.yaml`

#### Testing:
- Custom HTTP endpoints
- File-based responses
- FTP configuration
- Backward compat with defaults

---

### Feature 5: IPv6 as Primary Device Address

**Duration:** 2-4 days
**Priority:** MEDIUM
**Risk:** MEDIUM

#### Implementation Steps:

1. **Update Config Parser**
   - Detect IPv4 vs IPv6 in `ip` field
   - Set primary address type
   - Maintain IPAddresses slice

2. **Update Protocol Handlers**
   - Check primary address type
   - IPv6-first protocols: ICMPv6, DHCPv6, NDP
   - IPv4-first protocols: ARP, DHCP, ICMP

3. **Update Device Behavior**
   - IPv6-only devices don't respond to ARP
   - IPv4-only devices don't do NDP
   - Dual-stack devices do both

#### Files to Modify:
- `pkg/config/config.go`
- `pkg/protocols/stack.go`
- All protocol handlers (smart detection)
- `examples/scenario_configs/`

#### Testing:
- IPv6-only device
- IPv4-only device
- Dual-stack device
- Protocol selection logic

---

## Phase 3: Advanced Features (Week 3)

### Feature 6: Additional Traffic Patterns

**Duration:** 2-3 days
**Priority:** MEDIUM
**Risk:** HIGH

#### Implementation Steps:

1. **Design Traffic Pattern System**
   ```go
   type TrafficPattern interface {
       Start()
       Stop()
       Execute()
   }
   ```

2. **Implement Patterns**
   - DNSQueryPattern
   - HTTPRequestPattern
   - SNMPPollingPattern
   - DHCPRenewalPattern
   - NetBIOSBrowsingPattern
   - MulticastGroupPattern

3. **YAML Configuration**
   ```yaml
   traffic_patterns:
     dns_queries:
       enabled: true
       interval: 300s
   ```

4. **Integrate with Stack**
   - Pattern manager
   - Start/stop lifecycle
   - Configurable intervals

#### Files to Modify:
- `pkg/protocols/traffic_patterns.go` (new)
- `pkg/config/config.go`
- `pkg/protocols/stack.go`
- `examples/scenario_configs/complete-reference.yaml`

#### Testing:
- Each pattern individually
- Performance impact
- Pattern combinations
- Enable/disable at runtime

---

### Feature 7: SNMP Trap Generation

**Duration:** 3-4 days
**Priority:** MEDIUM
**Risk:** HIGH

#### Implementation Steps:

1. **SNMP Trap Protocol Support**
   - SNMPv2c trap format
   - SNMPv3 inform format
   - Trap encoding/sending

2. **Trap Configuration**
   ```yaml
   snmp_traps:
     enabled: true
     manager: "192.168.1.100"
     traps:
       - oid: "1.3.6.1.6.3.1.1.5.3"
         interval: 3600s
   ```

3. **Trap Generator**
   - Periodic traps
   - Event-triggered traps
   - Trap queue management

4. **Integration**
   - Add to SNMP agent
   - Configurable via YAML
   - Test with trap receivers

#### Files to Modify:
- `pkg/snmp/traps.go` (new)
- `pkg/snmp/agent.go`
- `pkg/config/config.go`
- `examples/scenario_configs/complete-reference.yaml`

#### Testing:
- Send traps to snmptrapd
- Verify trap format
- Test SNMPv2c and SNMPv3
- Periodic vs event-triggered

---

## Week 4: Testing & Release

### Integration Testing (Day 1-2)
- Test all features together
- Performance regression testing
- Backward compatibility testing
- Example configuration validation

### Documentation Updates (Day 3)
- Update README.md
- Update CHANGELOG.md for v1.5.0
- Update complete-reference.yaml
- Update feature documentation

### Build Releases (Day 4)
- Build all platform binaries
- Generate SHA256 checksums
- Create release README
- Tag v1.5.0

### Release (Day 5)
- Final testing
- Git tag and push
- GitHub release
- Announce features

---

## Post-v1.5.0: Walk & YAML Improvements

### Walk Files Review
- Organize by vendor/model
- Standardize naming convention
- Add validation tool
- Create walk file converter improvements

### YAML Configuration Review
- Evaluate JSON alternative
- Schema validation
- Config templates
- Migration tools

---

## Risk Mitigation

### High-Risk Items:
1. **Traffic Patterns** - Performance impact
   - Mitigation: Thorough performance testing, make optional

2. **SNMP Traps** - Timing/reliability
   - Mitigation: Use battle-tested gosnmp library, extensive testing

### Medium-Risk Items:
1. **Multiple IPs** - Protocol handler complexity
   - Mitigation: Incremental updates, test each protocol

2. **HTTP/FTP YAML** - Parsing complexity
   - Mitigation: Comprehensive YAML validation, clear error messages

---

## Success Metrics

- ✅ All 7 features implemented
- ✅ No performance regression (<5% acceptable)
- ✅ All existing tests pass
- ✅ New tests for all features (>80% coverage)
- ✅ Documentation complete
- ✅ Example configs updated
- ✅ Backward compatible with v1.4.0

---

**Started:** January 5, 2025
**Target Completion:** End of January 2025
**Status:** Phase 1, Feature 1 in progress

---

**Author:** Kris Armstrong
**Last Updated:** January 5, 2025
