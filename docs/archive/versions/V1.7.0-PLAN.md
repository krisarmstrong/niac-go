# NIAC-Go v1.7.0 Implementation Plan

## Overview
**Release Goal**: Production-ready quality with comprehensive testing and enhanced user experience

**Timeline**: 2-3 weeks
**Release Date Target**: Late November 2025

---

## Part 1: Testing Infrastructure (Priority: CRITICAL)

### Current State
- ✅ pkg/errors: 95.1% coverage (Excellent!)
- ⚠️ pkg/config: 9.8% coverage
- ⚠️ pkg/protocols: 5.6% coverage
- ❌ Missing: device, snmp, capture, converter, interactive, logging

### Target Coverage Goals
- **Critical packages**: 80%+ coverage
  - pkg/config (YAML parsing, validation)
  - pkg/device (simulator, traffic)
  - pkg/snmp (agent, traps)
  - internal/converter (YAML to config)

- **Important packages**: 60%+ coverage
  - pkg/protocols (all 19 protocols)
  - pkg/capture (packet handling)
  - pkg/interactive (TUI)

- **Supporting packages**: 40%+ coverage
  - pkg/logging
  - cmd/* (command-line tools)

### 1.1 Config Package Tests (Week 1, Days 1-2)

**Files to Test**: `pkg/config/config.go`, `pkg/config/loader.go`

**Test Coverage Needed**:
- ✅ Basic config parsing (already done)
- ❌ YAML loading and validation
- ❌ Device configuration validation
- ❌ Protocol configuration (LLDP, CDP, STP, etc.)
- ❌ Traffic pattern configuration (v1.6.0)
- ❌ SNMP trap configuration (v1.6.0)
- ❌ DHCP/DHCPv6 pool validation
- ❌ DNS record validation
- ❌ Multi-IP device handling
- ❌ Error handling for invalid configs
- ❌ Edge cases (empty configs, malformed YAML, etc.)

**Test Files**:
- `pkg/config/config_test.go` (expand existing)
- `pkg/config/yaml_test.go` (new - YAML-specific tests)
- `pkg/config/validation_test.go` (new - validation tests)

### 1.2 SNMP Package Tests (Week 1, Days 3-4)

**Files to Test**: `pkg/snmp/agent.go`, `pkg/snmp/traps.go`

**Test Coverage Needed**:
- ❌ SNMP agent initialization
- ❌ MIB-II system group responses
- ❌ Walk file loading
- ❌ GET/GET-NEXT/GET-BULK operations
- ❌ Trap generation (coldStart, linkUp/Down, etc.)
- ❌ Threshold-based trap triggers
- ❌ Multiple trap receivers
- ❌ Trap PDU formatting (SNMPv2c)

**Test Files**:
- `pkg/snmp/agent_test.go` (new)
- `pkg/snmp/traps_test.go` (new)

### 1.3 Device Simulator Tests (Week 1, Day 5 - Week 2, Day 1)

**Files to Test**: `pkg/device/simulator.go`, `pkg/device/traffic.go`

**Test Coverage Needed**:
- ❌ Device lifecycle (start/stop)
- ❌ Traffic generation (ARP, pings, random)
- ❌ Per-device traffic configuration
- ❌ Trap sender integration
- ❌ State management
- ❌ Concurrent device operations
- ❌ Device counters and statistics

**Test Files**:
- `pkg/device/simulator_test.go` (new)
- `pkg/device/traffic_test.go` (new)

### 1.4 Protocol Handler Tests (Week 2, Days 2-3)

**Files to Test**: All protocol handlers in `pkg/protocols/`

**Existing Tests**:
- ✅ ICMPv6 type names
- ✅ STP basic functions
- ✅ IPv6 parsing
- ✅ NetBIOS packet building

**Additional Tests Needed**:
- ❌ ARP request/response
- ❌ LLDP TLV encoding
- ❌ CDP packet format
- ❌ DHCP options encoding
- ❌ DHCPv6 options encoding
- ❌ DNS record encoding
- ❌ HTTP response formatting
- ❌ FTP command handling

**Test Files**:
- Expand existing `pkg/protocols/*_test.go` files
- Add missing test files for untested protocols

### 1.5 Converter Tests (Week 2, Day 4)

**Files to Test**: `internal/converter/converter.go`

**Test Coverage Needed**:
- ❌ Legacy .cfg format parsing
- ❌ YAML to config.Device conversion
- ❌ All protocol YAML parsing
- ❌ Traffic and trap YAML parsing (v1.6.0)
- ❌ Error handling for invalid YAML

**Test Files**:
- `internal/converter/converter_test.go` (new)

### 1.6 Integration Tests (Week 2, Day 5)

**Test Scenarios**:
- ❌ End-to-end device simulation
- ❌ Multi-device communication
- ❌ Traffic generation with trap sending
- ❌ SNMP queries during simulation
- ❌ Configuration reload
- ❌ Graceful shutdown

**Test Files**:
- `tests/integration/` (new directory)
- `tests/integration/simulation_test.go`
- `tests/integration/traffic_test.go`
- `tests/integration/snmp_test.go`

---

## Part 2: CLI & UX Improvements (Priority: HIGH)

### 2.1 Config Validation Tool (Week 3, Day 1)

**Feature**: Standalone config validator

**Implementation**:
```bash
# New command
./niac validate examples/complete-kitchen-sink.yaml

# Output
✓ Configuration is valid
  Devices: 9
  Protocols enabled: LLDP, CDP, HTTP, DHCP, DHCPv6, SNMP (traps)
  Traffic generation: 2 devices configured
  SNMP traps: 1 device configured

# Or with errors
✗ Configuration errors found:
  Line 45: Invalid IP address '192.168.1.999'
  Line 78: Unknown protocol field 'invalid_field'
  Device 'router-01': Missing required field 'mac'
```

**Files**:
- `cmd/niac/validate.go` (new subcommand)
- Integrate with existing `--dry-run` flag

### 2.2 Enhanced Error Messages (Week 3, Day 2)

**Current Issues**:
- Generic "failed to load config" errors
- No line numbers for YAML errors
- Unclear validation failures

**Improvements**:
- Show file path, line number, and column for YAML errors
- Contextual error messages with suggestions
- Color-coded error output
- Summary of all errors found (not just first)

**Example**:
```
Error loading configuration: examples/test.yaml

examples/test.yaml:45:12
  |
45|     threshold: ninety
  |                ^^^^^^
  |
Error: Invalid value for 'threshold': expected integer, got string 'ninety'
Suggestion: Use a number like: threshold: 90
```

### 2.3 Progress Indicators (Week 3, Day 3)

**Features**:
- Startup progress (loading config, initializing devices, starting protocols)
- Real-time statistics display
- Interactive mode enhancements

**Implementation**:
```
Starting NIAC-Go...
[1/5] Loading configuration... ✓ (9 devices)
[2/5] Initializing network stack... ✓
[3/5] Starting device simulators... ✓
[4/5] Enabling protocol handlers... ✓ (19 protocols)
[5/5] Starting traffic generation... ✓

✓ Simulation running with 9 devices on interface en0
  Press 'i' for interactive menu, 'q' to quit
```

### 2.4 Interactive Mode Enhancements (Week 3, Day 4)

**New Features**:
- Device status view (up/down, counters)
- Protocol enable/disable per device
- Live traffic statistics
- Trap history viewer
- Configuration hot-reload

**UI Mockup**:
```
┌─ NIAC Interactive Mode ─────────────────────────────────┐
│                                                          │
│ Devices (9 total, 9 up):                               │
│ ┌──────────────┬────────┬──────────────┬──────────────┐│
│ │ Name         │ Status │ Packets Sent │ Packets Recv ││
│ ├──────────────┼────────┼──────────────┼──────────────┤│
│ │ cisco-r1     │ UP ●   │ 1,234        │ 567          ││
│ │ hp-sw1       │ UP ●   │ 2,456        │ 1,234        ││
│ │ router-traps │ UP ●   │ 345 (3 traps)│ 123          ││
│ └──────────────┴────────┴──────────────┴──────────────┘│
│                                                          │
│ [v] View Device  [t] Traffic Stats  [s] SNMP Traps     │
│ [c] Clear Stats  [r] Reload Config  [q] Quit           │
└──────────────────────────────────────────────────────────┘
```

---

## Part 3: CI/CD Pipeline (Priority: HIGH)

### 3.1 GitHub Actions Workflow (Week 3, Day 5)

**File**: `.github/workflows/ci.yml`

**Pipeline Stages**:
1. **Build** (multiple OS/arch):
   - Linux (amd64, arm64)
   - macOS (amd64, arm64)
   - Windows (amd64)

2. **Test**:
   - Unit tests with coverage
   - Integration tests
   - Race detector (`go test -race`)
   - Coverage report to Codecov

3. **Lint**:
   - golangci-lint
   - go vet
   - go fmt check

4. **Examples Validation**:
   - Test all example YAML files with `--dry-run`
   - Ensure no examples are broken

5. **Release** (on tag):
   - Build binaries for all platforms
   - Create GitHub release
   - Upload artifacts

### 3.2 Pre-commit Hooks

**File**: `.pre-commit-config.yaml`

**Hooks**:
- Run `go fmt`
- Run `go vet`
- Run unit tests
- Check for TODO/FIXME comments

---

## Part 4: Performance & Benchmarking

### 4.1 Benchmark Suite

**Tests**:
- Config parsing (simple vs YAML)
- Packet generation rate
- SNMP query response time
- Traffic generation throughput
- Trap sending rate
- Device simulation overhead

**Files**:
- `pkg/config/config_bench_test.go`
- `pkg/device/traffic_bench_test.go`
- `pkg/snmp/snmp_bench_test.go`
- `benchmarks/` (comprehensive suite)

### 4.2 Performance Goals

Compare against Java version:
- Maintain 10x+ faster startup
- Maintain 77x+ faster error injection
- Target 1M+ packets/sec generation
- Sub-millisecond SNMP response

---

## Part 5: Documentation

### 5.1 API Documentation

- Complete GoDoc comments for all exported types/functions
- Architecture diagrams
- Protocol implementation notes
- Performance tuning guide

### 5.2 Testing Guide

- How to run tests
- How to write new tests
- Coverage goals and measurement
- Integration test setup

---

## Success Criteria

v1.7.0 is ready for release when:

- [ ] Overall test coverage ≥ 70%
- [ ] All critical packages ≥ 80% coverage
- [ ] CI/CD pipeline passing on all platforms
- [ ] Config validation tool working
- [ ] Enhanced error messages implemented
- [ ] Interactive mode improvements complete
- [ ] All example files validate successfully
- [ ] Performance benchmarks show no regression
- [ ] Documentation updated
- [ ] CHANGELOG.md and README.md updated

---

## Timeline Summary

**Week 1**: Testing Infrastructure (config, snmp)
**Week 2**: Testing Infrastructure (device, protocols, converter, integration)
**Week 3**: CLI/UX improvements + CI/CD
**Week 4**: Polish, documentation, release

---

## Next Steps

1. Start with config package tests (highest impact)
2. Add SNMP trap tests (new v1.6.0 feature)
3. Expand protocol tests
4. Build CI/CD pipeline in parallel
5. Add CLI improvements incrementally
6. Final integration testing and release
