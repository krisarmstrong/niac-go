# v1.23.0 Planning Document

**Status:** Planning Phase
**Target Release:** TBD
**Focus:** Walk File Enhancement & YAML Coverage

---

## Overview

Based on codebase analysis, v1.23.0 will focus on:
1. **Walk file analysis and sanitization**
2. **YAML example coverage expansion**
3. **Topology relationship support**

---

## 1. Walk File Analysis & Enhancement

### Current State
- **Total walk files:** 555 files
- **Location:** `examples/device_walks/misc/`
- **Vendors:** Cisco, Alcatel-Lucent, HP, Brocade, Nexus, etc.
- **Contains:** Port-channels, trunks, LAG configurations

### Findings

#### Port-Channel/LAG Support
Walk files contain port-channel and trunk port data:
- Port-channel interfaces (e.g., `port-channel1`, `port-channel100`)
- Member port references (Ethernet interfaces)
- LAG/LACP data structures
- Trunk configurations

**Example from n5k.walk:**
```
IF-MIB::ifDescr.369098752 = STRING: port-channel1
IF-MIB::ifDescr.369098753 = STRING: port-channel2
IF-MIB::ifDescr.436207616 = STRING: Ethernet1/1
IF-MIB::ifDescr.436211712 = STRING: Ethernet1/2
```

#### Current Issues
1. **No relationship tracking** - Walk files don't explicitly link port-channel members
2. **No cross-device references** - Each walk is isolated
3. **Potential sensitive data** - May contain:
   - Internal IP addresses
   - Location strings (sysLocation)
   - Contact information (sysContact)
   - Community strings (in some cases)
   - Device serial numbers
   - Internal hostnames

### Proposed Solutions

#### Issue #48: Walk File Sanitization Tool
**Priority:** High
**Complexity:** Medium

Create a tool to sanitize walk files while maintaining realistic corporate identity.

```bash
niac sanitize <input-walk> <output-walk> [flags]
```

**NIAC-Go Corp Branding Strategy:**

All sanitized data will use "NiAC-Go" as the fictional company:

**IP Address Mapping:**
- Map real IPs to NIAC-Go network ranges (maintain consistency)
- Use 10.0.0.0/8 for private networks
- Use 198.51.100.0/24 for DMZ/public-facing (RFC 5737)
- Create deterministic mapping (same input IP = same output IP)

**Contact Information:**
- sysContact: `netadmin@niac-go.com`
- sysLocation: `NiAC-Go - Data Center <region>`
- Organization: `NiAC-Go`

**Device Naming:**
- Switches: `niac-core-sw-01`, `niac-access-sw-12`, etc.
- Routers: `niac-core-rtr-01`, `niac-edge-rtr-02`, etc.
- Access Points: `niac-ap-floor3-01`, etc.
- Servers: `niac-dc-srv-01`, etc.
- Maintain original device type/role in new name

**Keep Original Data:**
- Serial numbers (KEPT - not sensitive)
- Vendor model numbers (KEPT - needed for realism)
- MAC addresses (KEPT - vendor OUI preserved)
- Interface counts (KEPT)
- Speed/duplex settings (KEPT)

**Replace/Sanitize:**
- IP addresses ‚Üí Consistent NIAC-Go network
- Hostnames ‚Üí NIAC-Go naming convention
- DNS domain ‚Üí niac-go.local, niac-go.com
- SNMP community strings ‚Üí "public" or "niac-go-ro"
- Location strings ‚Üí NIAC-Go locations
- Contact info ‚Üí NIAC-Go admin contacts

**Options:**
```
--ip-mapping-file FILE      Load/save IP mapping (JSON)
--domain niac-go.com        Domain for hostnames/DNS
--location "DC-WEST"        Default location suffix
--contact EMAIL             Contact email (default: netadmin@niac-go.com)
--preserve-structure        Keep original naming patterns
--community STRING          SNMP community (default: public)
```

**Example:**
```bash
# Sanitize single file with IP mapping
niac sanitize cisco-core.walk niac-core-sw-01.walk \
  --ip-mapping-file ip-map.json \
  --location "DC-WEST"

# Batch sanitize all walks
niac sanitize --batch examples/device_walks/misc/*.walk \
  --output-dir examples/device_walks/niac-corp/ \
  --ip-mapping-file niac-corp-network.json

# Generate mapping file first
niac sanitize --generate-mapping-only \
  examples/device_walks/misc/*.walk \
  --mapping-file niac-network-map.json
```

**IP Mapping File Format (JSON):**
```json
{
  "version": "1.0",
  "domain": "niac-go.com",
  "ip_mappings": {
    "132.194.6.101": "10.0.1.101",
    "140.226.232.1": "10.0.2.1",
    "172.21.96.10": "10.1.0.10"
  },
  "hostname_mappings": {
    "prod-core-01": "niac-core-sw-01",
    "dc1-rtr-01": "niac-core-rtr-01"
  },
  "networks": {
    "132.194.0.0/16": "10.0.0.0/16",
    "140.226.0.0/16": "10.1.0.0/16",
    "172.21.0.0/16": "10.2.0.0/16"
  }
}
```

**NIAC-Go Network Architecture:**
```
10.0.0.0/8       - NIAC-Go Internal Network
  10.0.0.0/16    - Data Center West
  10.1.0.0/16    - Data Center East
  10.2.0.0/16    - Corporate Campus
  10.3.0.0/16    - Remote Offices
  10.100.0.0/16  - Management Network
  10.200.0.0/16  - Guest/IoT Network

198.51.100.0/24  - NIAC-Go DMZ (RFC 5737)
203.0.113.0/24   - NIAC-Go Public Services (RFC 5737)

niac-go.com      - Public domain
niac-go.local    - Internal AD domain
```

**Device Naming Convention:**
```
Pattern: niac-<location>-<type>-<number>

Examples:
- niac-core-sw-01       (Core switch 1)
- niac-dist-sw-floor2   (Distribution switch, floor 2)
- niac-access-sw-12     (Access switch 12)
- niac-edge-rtr-west    (Edge router, west)
- niac-dc-srv-web01     (Web server 01)
- niac-ap-bldg3-201     (Access point, building 3, room 201)
```

#### Issue #49: Topology Relationship Tracking
**Priority:** High
**Complexity:** High

Add support for inter-device relationships:

**New YAML Configuration:**
```yaml
devices:
  - name: core-switch-1
    mac: "00:11:22:33:44:01"
    ips:
      - "10.0.0.1"

    # NEW: Port-channel/LAG configuration
    port_channels:
      - id: 1
        members: ["Ethernet1/1", "Ethernet1/2"]
        mode: "active"  # LACP mode
      - id: 2
        members: ["Ethernet1/3", "Ethernet1/4"]
        mode: "passive"

    # NEW: Trunk port configuration
    trunk_ports:
      - interface: "port-channel1"
        vlans: [1, 10, 20, 30]
        native_vlan: 1
        remote_device: "core-switch-2"
        remote_interface: "port-channel1"

    snmp_agent:
      walk_file: "switches/core-switch-1.walk"
```

**Benefits:**
- Realistic network topology simulation
- Proper LLDP neighbor discovery
- Accurate CDP/EDP neighbor tables
- Trunk port validation
- Multi-device scenarios

#### Issue #50: Walk File Relationship Parser
**Priority:** Medium
**Complexity:** High

Parse walk files to extract relationships:

```bash
niac analyze-walk <walk-file> [flags]
```

**Output:**
```yaml
device: core-switch-1
interfaces:
  - name: Ethernet1/1
    type: physical
    speed: 1000000000
    member_of: port-channel1
  - name: port-channel1
    type: logical
    members: [Ethernet1/1, Ethernet1/2]
    trunk: true
    vlans: [1, 10, 20, 30]

neighbors:
  - local_interface: Ethernet1/1
    remote_device: core-switch-2
    remote_interface: Ethernet1/1
    protocol: CDP
```

---

## 2. YAML Example Coverage Expansion

### Current Coverage

| Protocol | Example Files | Coverage |
|----------|---------------|----------|
| LLDP | 15 | ‚úÖ Excellent |
| CDP | 6 | ‚úÖ Good |
| EDP | 4 | üü° Moderate |
| FDP | 4 | üü° Moderate |
| STP | 1 | üü† Low |
| DHCP | 3 | üü° Moderate |
| DHCPv6 | 1 | üü† Low |
| DNS | 5 | ‚úÖ Good |
| HTTP | 1 | üü† Low |
| FTP | 3 | üü° Moderate |
| **SNMP** | **0** | ‚ùå **None!** |
| ICMP | 2 | üü† Low |
| ICMPv6 | 1 | üü† Low |
| NetBIOS | 1 | üü† Low |
| ARP | 2 | üü† Low |

### Missing Examples

#### Critical Gaps
1. **No SNMP examples!** - Despite having SNMP agent support
2. **No SNMP trap examples** - trap generation added in v1.6.0
3. **No port-channel/LAG examples**
4. **No VLAN examples**
5. **No multi-device topology examples**

#### New Examples Needed

##### Issue #51: SNMP Configuration Examples
**Priority:** Critical (we have the feature, no examples!)

Create:
- `examples/snmp/snmp-agent-basic.yaml` - Simple SNMP agent
- `examples/snmp/snmp-traps-all.yaml` - All trap types
- `examples/snmp/snmp-multiple-communities.yaml` - Multiple community strings
- `examples/snmp/snmp-with-walk-file.yaml` - Using walk files

##### Issue #52: Topology Examples
**Priority:** High

Create:
- `examples/topology/two-switch-trunk.yaml` - Two switches with trunk link
- `examples/topology/router-switch-ap.yaml` - Complete network topology
- `examples/topology/port-channel-lab.yaml` - LAG/port-channel configuration
- `examples/topology/vlan-network.yaml` - VLAN configuration
- `examples/topology/dhcp-relay.yaml` - DHCP relay scenario

##### Issue #53: Protocol Combination Examples
**Priority:** Medium

Create:
- `examples/combinations/enterprise-router.yaml` - Router with all protocols
- `examples/combinations/datacenter-switch.yaml` - DC switch with FCoE/TRILL
- `examples/combinations/access-switch.yaml` - Access switch with PoE
- `examples/combinations/wireless-controller.yaml` - WLC configuration

---

## 3. Implementation Plan

### Phase 1: Walk File Sanitization (Week 1)
- [ ] Create `cmd/niac/sanitize.go` command
- [ ] Implement IP anonymization
- [ ] Implement contact info removal
- [ ] Implement serial number removal
- [ ] Add tests for sanitization
- [ ] Document sanitization process

### Phase 2: SNMP Examples (Week 1)
- [ ] Create 4 SNMP example files
- [ ] Validate all examples
- [ ] Update examples/EXAMPLES-README.md
- [ ] Add to CI/CD validation

### Phase 3: Topology Support (Week 2-3)
- [ ] Design YAML schema for topology
- [ ] Implement port-channel config parsing
- [ ] Implement trunk port config parsing
- [ ] Update LLDP/CDP to use topology
- [ ] Add validation for topology config

### Phase 4: Topology Examples (Week 3)
- [ ] Create 5 topology example files
- [ ] Create comprehensive topology test
- [ ] Validate neighbor discovery works
- [ ] Update documentation

### Phase 5: Walk File Analysis (Week 4)
- [ ] Create `niac analyze-walk` command
- [ ] Parse interface relationships
- [ ] Extract neighbor information
- [ ] Generate topology YAML from walk
- [ ] Add tests

---

## 4. Testing Requirements

### New Tests Needed

1. **Sanitization Tests**
   - IP anonymization correctness
   - Contact info removal
   - Mapping file generation
   - Idempotency

2. **Topology Tests**
   - Port-channel member validation
   - Trunk port VLAN validation
   - Cross-device reference validation
   - LLDP/CDP neighbor discovery

3. **Walk Parser Tests**
   - Interface parsing
   - Relationship extraction
   - OID parsing accuracy

4. **Example Validation Tests**
   - All new examples must validate
   - All new examples must load
   - No syntax errors

### Coverage Goals
- cmd/niac: 35.4% ‚Üí 45% (add sanitize, analyze tests)
- pkg/config: 54.6% ‚Üí 60% (add topology parsing tests)

---

## 5. Documentation Updates

### New Documentation Required

1. **Walk File Guide**
   - How to sanitize walk files
   - How to analyze walk files
   - How to extract topology
   - Security best practices

2. **Topology Configuration Guide**
   - Port-channel configuration
   - Trunk port configuration
   - VLAN configuration
   - Cross-device references

3. **SNMP Configuration Guide**
   - SNMP agent setup
   - Walk file usage
   - Trap configuration
   - Community string security

4. **Examples README Updates**
   - Add SNMP section
   - Add topology section
   - Add sanitization section

---

## 6. Release Criteria

### v1.23.0 Must Have:
- ‚úÖ Walk file sanitization tool
- ‚úÖ 4+ SNMP configuration examples
- ‚úÖ Port-channel/LAG YAML support
- ‚úÖ 2+ topology examples
- ‚úÖ Updated documentation
- ‚úÖ All tests passing
- ‚úÖ No regressions

### v1.23.0 Nice to Have:
- Walk file relationship parser
- 5+ topology examples
- VLAN support
- Complete topology guide

---

## 7. Security Considerations

### Walk File Sanitization - NIAC-Go Corp Approach

**Philosophy:** Create realistic, shareable data that tells a story without exposing real networks.

**What We KEEP (Not Sensitive):**
- ‚úÖ Serial numbers - Generic device identifiers
- ‚úÖ MAC addresses - Vendor OUI is public info
- ‚úÖ Hardware models - Public product information
- ‚úÖ Interface counts/types - Network topology data
- ‚úÖ Speed/duplex settings - Standard configuration
- ‚úÖ VLAN IDs - Common network design

**What We TRANSFORM (Deterministic Mapping):**
- üîÑ IP addresses ‚Üí NIAC-Go network (10.0.0.0/8, 198.51.100.0/24)
- üîÑ Hostnames ‚Üí NIAC-Go naming (niac-core-sw-01, etc.)
- üîÑ DNS domains ‚Üí niac-go.com / niac-go.local
- üîÑ Contact info ‚Üí netadmin@niac-go.com
- üîÑ Location strings ‚Üí "NiAC-Go - DC-WEST"
- üîÑ Community strings ‚Üí "public" or "niac-go-ro"

**Key Security Features:**
1. **Deterministic Mapping:** Same input IP always maps to same output IP
   - Preserves network relationships and topology
   - Enables multi-device scenarios
   - Maintains routing consistency

2. **Mapping File Tracking:** JSON file records all transformations
   - Allows reversible mapping if needed for debugging
   - Ensures consistency across 555 walk files
   - Can be version controlled separately

3. **Network Architecture:** Use RFC 5737 and RFC 1918 addresses
   - 10.0.0.0/8 for internal NIAC-Go networks
   - 198.51.100.0/24 for DMZ (TEST-NET-2)
   - 203.0.113.0/24 for public services (TEST-NET-3)
   - No risk of conflict with real networks

4. **Corporate Branding:** "NiAC-Go" fictional company
   - Memorable and recognizable
   - Professional appearance in examples
   - Clear it's demonstration data
   - Fun story: "Network Infrastructure As Code - Go Corporation"

**Validation Requirements:**
- [ ] All real IPs must be mapped to NIAC-Go ranges
- [ ] No real email addresses in output
- [ ] No real physical locations in output
- [ ] Mapping file must be created for all batch operations
- [ ] Network topology must remain valid after transformation
- [ ] LLDP/CDP neighbor data must reflect mapped names/IPs

**Testing:**
- [ ] Grep for common internal IP patterns (172.x, 192.168.x private ranges)
- [ ] Check for email domains other than niac-go.com
- [ ] Verify sysLocation contains "NiAC-Go"
- [ ] Confirm sysContact is netadmin@niac-go.com
- [ ] Validate DNS names use niac-go.com/niac-go.local
- [ ] Test mapping reversibility (optional debug feature)

### Community Strings
- **Default:** All sanitized walks use "public" for SNMPv2c
- **Read-Only Alternative:** "niac-go-ro" for read-only examples
- **Warning:** Document that real deployments should use SNMPv3
- **Future:** v2.x will add SNMPv3 with USM (User-based Security Model)

### Topology Data
- **Validate:** Cross-device references use mapped names
- **Security:** No command injection via device names (alphanumeric + hyphen only)
- **Consistency:** All topology examples use NIAC-Go network architecture
- **Documentation:** Network diagram showing NIAC-Go Corp layout

---

## 8. Timeline

**Estimated Duration:** 4 weeks

| Week | Focus | Deliverables |
|------|-------|--------------|
| 1 | Sanitization + SNMP | Sanitize command, 4 SNMP examples |
| 2 | Topology Design | YAML schema, config parsing |
| 3 | Topology Implementation | Port-channel support, neighbor updates |
| 4 | Examples + Polish | 5 topology examples, docs, tests |

---

## 9. Success Metrics

- [ ] 555 walk files can be sanitized
- [ ] Zero manual IP redaction needed
- [ ] SNMP examples cover all features
- [ ] Topology examples demonstrate real networks
- [ ] Documentation is comprehensive
- [ ] Test coverage improved
- [ ] User feedback is positive

---

## 10. Future Enhancements (v1.24+)

- VLAN tagging support (802.1Q)
- SNMP v3 support
- Advanced LAG modes (static, LACP)
- Inter-VLAN routing
- DHCP relay/helper
- Quality of Service (QoS)
- Network Address Translation (NAT)

---

**Ready for Team Review** üìã

Questions or feedback? Open a discussion on GitHub!
